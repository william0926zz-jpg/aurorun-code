"use strict";const e=require("../../common/vendor.js"),r=require("../../utils/audio.js"),m=require("../../utils/cdn.js"),d={data(){return{selectedLevel:null,selectedTimes:null,isRunning:!1,startTime:null,elapsedTime:0,timer:null,totalPoints:0,records:[],backgroundAudios:[m.AUDIO_CDN.forest1,m.AUDIO_CDN.forest2],volume:.5,showVolumePanel:!1}},computed:{currentTitle(){return this.totalPoints>=300?"å¤©ç”Ÿçš„è·‘è€…":this.totalPoints>=100?"è·‘æ­¥å¥å°†":this.totalPoints>=30?"å°æœ‰ç»éªŒçš„è·‘è€…":"æ–°æ‰‹è·‘è€…"}},onLoad(){this.loadData(),this.loadVolume()},onUnload(){this.timer&&clearInterval(this.timer),r.audioManager.stopBackground()},methods:{loadData(){try{const s=e.index.getStorageSync("totalPoints");s&&(this.totalPoints=parseInt(s)||0);const n=e.index.getStorageSync("targetRecords");n&&(this.records=JSON.parse(n)||[])}catch(s){console.error("åŠ è½½æ•°æ®å¤±è´¥:",s)}},saveData(){try{e.index.setStorageSync("totalPoints",this.totalPoints.toString()),e.index.setStorageSync("targetRecords",JSON.stringify(this.records))}catch(s){console.error("ä¿å­˜æ•°æ®å¤±è´¥:",s)}},selectLevel(s,n){if(this.isRunning){e.index.showToast({title:"è¯·å…ˆç»“æŸå½“å‰è®¡æ—¶",icon:"none"});return}this.selectedLevel=s,this.selectedTimes=n},handleAction(){if(!this.selectedLevel||!this.selectedTimes){e.index.showToast({title:"è¯·å…ˆé€‰æ‹©éš¾åº¦å’Œæ¬¡æ•°",icon:"none"});return}this.isRunning?this.stopTimer():this.startTimer()},startTimer(){this.isRunning=!0,this.startTime=Date.now(),this.elapsedTime=0,r.audioManager.setVolume(this.volume);const s=Math.floor(Math.random()*this.backgroundAudios.length),n=this.backgroundAudios[s];console.log("å¼€å§‹æ’­æ”¾èƒŒæ™¯éŸ³ä¹:",n,"éŸ³é‡:",this.volume),r.audioManager.playBackground(n,!0),this.timer=setInterval(()=>{this.elapsedTime=Date.now()-this.startTime},100)},stopTimer(){if(!this.isRunning)return;this.isRunning=!1,r.audioManager.stopBackground(),this.timer&&(clearInterval(this.timer),this.timer=null);const n={1:1,2:2,3:5}[this.selectedLevel]*this.selectedTimes,i=this.totalPoints;this.totalPoints+=n;const a={id:Date.now().toString(),level:this.selectedLevel,times:this.selectedTimes,points:n,duration:this.elapsedTime,date:new Date().toISOString(),formattedTime:this.formatTime(this.elapsedTime)};this.records.unshift(a),this.saveData();const l=this.getTitleByPoints(i),o=this.currentTitle;if(l!==o){let t="";i<100&&this.totalPoints>=100&&(t=`

ğŸŠ åŒæ—¶è§£é”åŒ¹é…åŠŸèƒ½ï¼`),e.index.showModal({title:"ğŸ‰ æ­å–œï¼",content:`æ‚¨è·å¾—äº†æ–°ç§°å·ï¼š${o}${t}`,showCancel:!1,success:()=>{l===o&&i<100&&this.totalPoints>=100&&setTimeout(()=>{e.index.showModal({title:"ğŸŠ åŠŸèƒ½è§£é”",content:`æ­å–œï¼æ‚¨å·²è§£é”åŒ¹é…åŠŸèƒ½ï¼
ç°åœ¨å¯ä»¥åœ¨é¦–é¡µä½¿ç”¨åŒ¹é…åŠŸèƒ½äº†ã€‚`,showCancel:!1})},500)}})}else i<100&&this.totalPoints>=100&&e.index.showModal({title:"ğŸŠ åŠŸèƒ½è§£é”",content:`æ­å–œï¼æ‚¨å·²è§£é”åŒ¹é…åŠŸèƒ½ï¼
ç°åœ¨å¯ä»¥åœ¨é¦–é¡µä½¿ç”¨åŒ¹é…åŠŸèƒ½äº†ã€‚`,showCancel:!1});e.index.showToast({title:`å®Œæˆï¼è·å¾—${n}ç§¯åˆ†`,icon:"success"}),this.selectedLevel=null,this.selectedTimes=null,this.elapsedTime=0},formatTime(s){const n=Math.floor(s/1e3),i=Math.floor(n/60),a=n%60;return`${i.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},getTitleByPoints(s){return s>=300?"å¤©ç”Ÿçš„è·‘è€…":s>=100?"è·‘æ­¥å¥å°†":s>=30?"å°æœ‰ç»éªŒçš„è·‘è€…":"æ–°æ‰‹è·‘è€…"},goHistory(){e.index.navigateTo({url:"/pages/target/history"})},goHome(){e.index.reLaunch({url:"/pages/home/home"})},toggleVolumePanel(){this.showVolumePanel=!this.showVolumePanel},closeVolumePanel(){this.showVolumePanel=!1},onVolumeChange(s){const n=s.detail.value/100;this.setVolume(n)},setVolume(s){this.volume=Math.max(0,Math.min(1,s)),r.audioManager.setVolume(this.volume);try{e.index.setStorageSync("audioVolume",this.volume.toString())}catch(n){console.error("ä¿å­˜éŸ³é‡è®¾ç½®å¤±è´¥:",n)}},loadVolume(){try{const s=e.index.getStorageSync("audioVolume");s!==null&&s!==""&&(this.volume=parseFloat(s)||.5),r.audioManager.setVolume(this.volume)}catch(s){console.error("åŠ è½½éŸ³é‡è®¾ç½®å¤±è´¥:",s)}}},computed:{volumeIcon(){return this.volume===0?"ğŸ”‡":this.volume<.3?"ğŸ”‰":(this.volume<.7,"ğŸ”Š")}}};function g(s,n,i,a,l,o){return e.e({a:e.o((...t)=>o.goHome&&o.goHome(...t)),b:e.t(o.volumeIcon),c:e.o((...t)=>o.toggleVolumePanel&&o.toggleVolumePanel(...t)),d:e.o((...t)=>o.goHistory&&o.goHistory(...t)),e:l.showVolumePanel},l.showVolumePanel?{f:e.o((...t)=>o.closeVolumePanel&&o.closeVolumePanel(...t))}:{},{g:l.showVolumePanel},l.showVolumePanel?{h:e.o((...t)=>o.closeVolumePanel&&o.closeVolumePanel(...t)),i:e.t(Math.round(l.volume*100)),j:l.volume*100,k:e.o((...t)=>o.onVolumeChange&&o.onVolumeChange(...t)),l:e.o(t=>o.setVolume(0)),m:e.o(t=>o.setVolume(.3)),n:e.o(t=>o.setVolume(.6)),o:e.o(t=>o.setVolume(1))}:{},{p:e.f([1,2,5],(t,u,c)=>({a:e.t(t),b:t,c:l.selectedLevel===1&&l.selectedTimes===t?1:"",d:e.o(h=>o.selectLevel(1,t),t)})),q:l.selectedLevel===1?1:"",r:e.f([1,2,5],(t,u,c)=>({a:e.t(t),b:t,c:l.selectedLevel===2&&l.selectedTimes===t?1:"",d:e.o(h=>o.selectLevel(2,t),t)})),s:l.selectedLevel===2?1:"",t:e.f([1,2,5],(t,u,c)=>({a:e.t(t),b:t,c:l.selectedLevel===3&&l.selectedTimes===t?1:"",d:e.o(h=>o.selectLevel(3,t),t)})),v:l.selectedLevel===3?1:"",w:e.t(l.isRunning?"ç»“æŸ":"å¼€å§‹"),x:e.o((...t)=>o.handleAction&&o.handleAction(...t)),y:l.isRunning},l.isRunning?{z:e.t(o.formatTime(l.elapsedTime))}:{},{A:e.t(l.totalPoints),B:e.t(o.currentTitle)})}const v=e._export_sfc(d,[["render",g],["__scopeId","data-v-bfbe8513"]]);xhs.createPage(v);
