"use strict";const t=require("../../common/vendor.js"),o=require("../../api/match.js");require("../../utils/request.js");const m={data(){return{matching:!1,matchResult:null,preferences:{ageMin:"",ageMax:"",visionType:""}}},onLoad(){},methods:{async startMatch(){if(!t.index.getStorageSync("userProfile")){t.index.showModal({title:"提示",content:"请先完善个人信息后再进行匹配",showCancel:!0,confirmText:"去完善",success:n=>{n.confirm&&t.index.navigateTo({url:"/pages/user/profile"})}});return}this.matching=!0,this.matchResult=null;try{const n={};this.preferences.ageMin&&this.preferences.ageMax&&(n.ageRange=[parseInt(this.preferences.ageMin),parseInt(this.preferences.ageMax)]),this.preferences.visionType&&(n.visionType=this.preferences.visionType);try{const h=t.index.getStorageSync("userRole")||"blind";n.role=h}catch{}const i=await o.startMatch(n);i.code===200&&i.data?setTimeout(()=>{this.matchResult=i.data,this.matching=!1},1500):(this.matching=!1,t.index.showToast({title:i.message||"匹配失败",icon:"none"}))}catch(n){console.error("匹配失败:",n),this.matching=!1,t.index.showToast({title:"匹配失败，请稍后重试",icon:"none"})}},viewMatchList(){t.index.showToast({title:"功能开发中",icon:"none"})},getMatchLevelClass(r){return r>=.8?"match-excellent":r>=.6?"match-good":r>=.4?"match-normal":"match-low"},getMatchLevelText(r){return r>=.8?"高度匹配":r>=.6?"良好匹配":r>=.4?"一般匹配":"较低匹配"},formatVisionType(r){return r==="half"?"半盲":r==="full"?"全盲":r||"未填写"},goBack(){t.index.navigateBack()}}};function l(r,n,i,h,e,c){return t.e({a:t.o((...s)=>c.goBack&&c.goBack(...s)),b:!e.matching&&!e.matchResult},!e.matching&&!e.matchResult?t.e({c:e.preferences.ageMin,d:t.o(s=>e.preferences.ageMin=s.detail.value),e:e.preferences.ageMax,f:t.o(s=>e.preferences.ageMax=s.detail.value),g:e.preferences.visionType==="half"},e.preferences.visionType==="half"?{}:{},{h:e.preferences.visionType==="half"?1:"",i:t.o(s=>e.preferences.visionType="half"),j:e.preferences.visionType==="full"},e.preferences.visionType==="full"?{}:{},{k:e.preferences.visionType==="full"?1:"",l:t.o(s=>e.preferences.visionType="full"),m:e.preferences.visionType===""},e.preferences.visionType===""?{}:{},{n:e.preferences.visionType===""?1:"",o:t.o(s=>e.preferences.visionType=""),p:t.o((...s)=>c.startMatch&&c.startMatch(...s))}):{},{q:e.matching},e.matching?{}:{},{r:e.matchResult&&!e.matching},e.matchResult&&!e.matching?t.e({s:e.matchResult.matchedUser.avatar||"/static/logo.png",t:t.t(e.matchResult.matchedUser.nickname||"用户"),v:t.t(e.matchResult.matchScore||0),w:e.matchResult.comparison},e.matchResult.comparison?t.e({x:e.matchResult.comparison.age},e.matchResult.comparison.age?{y:t.t(e.matchResult.comparison.age.mine),z:t.t(e.matchResult.comparison.age.other),A:t.t(c.getMatchLevelText(e.matchResult.comparison.age.match)),B:t.n(c.getMatchLevelClass(e.matchResult.comparison.age.match))}:{},{C:e.matchResult.comparison.height},e.matchResult.comparison.height?{D:t.t(e.matchResult.comparison.height.mine),E:t.t(e.matchResult.comparison.height.other),F:t.t(c.getMatchLevelText(e.matchResult.comparison.height.match)),G:t.n(c.getMatchLevelClass(e.matchResult.comparison.height.match))}:{},{H:e.matchResult.comparison.weight},e.matchResult.comparison.weight?{I:t.t(e.matchResult.comparison.weight.mine),J:t.t(e.matchResult.comparison.weight.other),K:t.t(c.getMatchLevelText(e.matchResult.comparison.weight.match)),L:t.n(c.getMatchLevelClass(e.matchResult.comparison.weight.match))}:{},{M:e.matchResult.comparison.visionType},e.matchResult.comparison.visionType?{N:t.t(c.formatVisionType(e.matchResult.comparison.visionType.mine)),O:t.t(c.formatVisionType(e.matchResult.comparison.visionType.other)),P:t.t(c.getMatchLevelText(e.matchResult.comparison.visionType.match)),Q:t.n(c.getMatchLevelClass(e.matchResult.comparison.visionType.match))}:{},{R:e.matchResult.comparison.experience},e.matchResult.comparison.experience?{S:t.t(e.matchResult.comparison.experience.mine||"未填写"),T:t.t(e.matchResult.comparison.experience.other||"未填写"),U:t.t(c.getMatchLevelText(e.matchResult.comparison.experience.match)),V:t.n(c.getMatchLevelClass(e.matchResult.comparison.experience.match))}:{},{W:e.matchResult.comparison.runningArea},e.matchResult.comparison.runningArea?{X:t.t(e.matchResult.comparison.runningArea.mine||"未填写"),Y:t.t(e.matchResult.comparison.runningArea.other||"未填写"),Z:t.t(c.getMatchLevelText(e.matchResult.comparison.runningArea.match)),aa:t.n(c.getMatchLevelClass(e.matchResult.comparison.runningArea.match))}:{}):{},{ab:t.o((...s)=>c.startMatch&&c.startMatch(...s)),ac:t.o((...s)=>c.viewMatchList&&c.viewMatchList(...s))}):{})}const a=t._export_sfc(m,[["render",l],["__scopeId","data-v-49ea9551"]]);xhs.createPage(a);
