"use strict";const s=require("../../common/vendor.js"),g=require("../../api/auth.js"),a=require("../../utils/request.js"),c={data(){return{account:"",password:"",showPwd:!1,isLoading:!1,message:"",role:"blind"}},computed:{isReady(){const e=this.account.trim(),o=this.password.trim(),n=/\d/.test(o);return e.length>0&&o.length>=8&&n},btnText(){return this.isLoading?"提交中...":this.message?this.message:this.isReady?"注册":"请完善信息"}},methods:{togglePwd(){this.showPwd=!this.showPwd},async doRegister(){if(!(!this.isReady||this.isLoading)){this.isLoading=!0,this.message="";try{const e=await g.register(this.account.trim(),this.password.trim(),this.role);if(e.code===200&&e.data){a.api.setToken(e.data.token),e.data.refreshToken&&a.api.setRefreshToken(e.data.refreshToken);try{const o=this.account.trim();s.index.setStorageSync("userRole_"+o,this.role),s.index.setStorageSync("userRole",this.role)}catch{}this.message="注册成功 ✓",setTimeout(()=>{this.role==="volunteer"?s.index.reLaunch({url:"/pages/volunteer/home"}):s.index.reLaunch({url:"/pages/home/home"})},600)}else this.message=e.message||"注册失败"}catch(e){console.error("注册错误:",e),e.statusCode&&e.data&&e.data.message?this.message=e.data.message:e.errMsg&&(e.errMsg.includes("fail")||e.errMsg.includes("CONNECTION"))?this.message="无法连接到服务器，请检查网络或后端服务":e.errMsg&&e.errMsg.includes("EMPTY_RESPONSE")?this.message="服务器无响应，请稍后重试":this.message=e.message||"网络错误，请稍后重试"}finally{this.isLoading=!1,this.message&&!this.message.includes("成功")&&setTimeout(()=>{this.message=""},2e3)}}},goLogin(){s.index.navigateBack()}}};function l(e,o,n,d,t,i){return s.e({a:t.account,b:s.o(s.m(r=>t.account=r.detail.value,{trim:!0})),c:!t.showPwd,d:t.password,e:s.o(r=>t.password=r.detail.value),f:s.t(t.showPwd?"隐藏":"显示"),g:s.o((...r)=>i.togglePwd&&i.togglePwd(...r)),h:t.role==="blind"},t.role==="blind"?{}:{},{i:t.role==="blind"?1:"",j:s.o(r=>t.role="blind"),k:t.role==="volunteer"},t.role==="volunteer"?{}:{},{l:t.role==="volunteer"?1:"",m:s.o(r=>t.role="volunteer"),n:s.t(i.btnText),o:i.isReady?1:"",p:t.isLoading?1:"",q:!i.isReady||t.isLoading,r:s.o((...r)=>i.doRegister&&i.doRegister(...r)),s:s.o((...r)=>i.goLogin&&i.goLogin(...r))})}const h=s._export_sfc(c,[["render",l],["__scopeId","data-v-7a0d3351"]]);xhs.createPage(h);
