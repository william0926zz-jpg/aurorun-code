"use strict";const u=require("../common/vendor.js");class t{constructor(){this.backgroundAudio=null,this.soundEffects={},this.isPlaying=!1,this.volume=.5}playBackground(i,n=!0){this.stopBackground(),this.backgroundAudio=u.index.createInnerAudioContext(),this.backgroundAudio.src=i,this.backgroundAudio.loop=n,this.backgroundAudio.volume=this.volume,this.backgroundAudio.play(),this.isPlaying=!0,this.backgroundAudio.onError(o=>{console.error("背景音乐播放失败:",o),this.isPlaying=!1})}stopBackground(){this.backgroundAudio&&(this.backgroundAudio.stop(),this.backgroundAudio.destroy(),this.backgroundAudio=null,this.isPlaying=!1)}pauseBackground(){this.backgroundAudio&&this.isPlaying&&(this.backgroundAudio.pause(),this.isPlaying=!1)}resumeBackground(){this.backgroundAudio&&!this.isPlaying&&(this.backgroundAudio.play(),this.isPlaying=!0)}setVolume(i){this.volume=Math.max(0,Math.min(1,i)),this.backgroundAudio&&(this.backgroundAudio.volume=this.volume)}playSound(i,n=.7){{const o=u.index.createInnerAudioContext();o.src=i,o.volume=n,o.play(),o.onEnded(()=>{o.destroy()}),o.onError(s=>{console.error("音效播放失败:",s),o.destroy()})}}preload(i){return new Promise((n,o)=>{{const s=u.index.createInnerAudioContext();s.src=i,s.onCanplay(()=>{s.destroy(),n()}),s.onError(r=>{s.destroy(),o(r)})}})}}const d=new t;exports.audioManager=d;
