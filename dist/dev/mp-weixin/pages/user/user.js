"use strict";const e=require("../../common/vendor.js"),s=require("../../api/auth.js"),d=require("../../api/user.js"),a=require("../../utils/request.js"),u={methods:{goBack(){e.index.navigateBack()},goProfile(){e.index.navigateTo({url:"/pages/user/profile"})},goAccountManage(){},goFeedback(){},goAbout(){},doLogout(){e.index.showModal({title:"提示",content:"确定退出登录吗？",success:async i=>{if(i.confirm)try{await s.logout()}catch{}finally{a.api.setToken(""),a.api.setRefreshToken&&a.api.setRefreshToken(""),e.index.reLaunch({url:"/pages/login/login"})}}})},async doDeleteAccount(){e.index.showModal({title:"注销账号",content:"注销账号将永久删除您的所有数据，此操作不可恢复。确定要注销吗？",confirmText:"确定注销",cancelText:"取消",confirmColor:"#ff4d4f",success:async i=>{if(i.confirm){e.index.showLoading({title:"注销中...",mask:!0});try{await d.deleteAccount();try{const o=e.index.getStorageSync("account")||"";e.index.removeStorageSync("token"),e.index.removeStorageSync("refreshToken"),e.index.removeStorageSync("userProfile"),e.index.removeStorageSync("userRole"),o&&e.index.removeStorageSync("userRole_"+o),e.index.removeStorageSync("account"),e.index.removeStorageSync("totalPoints"),e.index.removeStorageSync("targetRecords"),e.index.removeStorageSync("audioVolume"),a.api.setToken(""),a.api.setRefreshToken&&a.api.setRefreshToken("");try{(e.index.getStorageInfoSync().keys||[]).forEach(t=>{(t.includes("user")||t.includes("token")||t.includes("role")||t.includes("account")||t.includes("profile")||t.includes("points")||t.includes("target")||t.includes("audio"))&&e.index.removeStorageSync(t)})}catch{}}catch(o){console.error("清除本地数据失败:",o)}e.index.hideLoading(),e.index.reLaunch({url:"/pages/login/login",success:()=>{e.index.showToast({title:"账号已注销",icon:"success",duration:1500})}})}catch(o){e.index.hideLoading(),console.error("注销账号失败:",o);let r="注销失败，请重试";o.statusCode===404?r=`后端删除账号接口未实现（404）。

请联系后端开发人员添加 DELETE /api/user/account 接口，或暂时使用"退出登录"功能。`:o.statusCode===401?r="登录已过期，请重新登录":o.data&&o.data.message?r=o.data.message:o.errMsg&&o.errMsg.includes("fail")&&(r="网络错误，请检查网络连接"),e.index.showModal({title:"注销失败",content:r,showCancel:!1,confirmText:"确定"})}}}})}}};function g(i,o,r,t,f,n){return{a:e.o((...c)=>n.goBack&&n.goBack(...c)),b:e.o((...c)=>n.goProfile&&n.goProfile(...c)),c:e.o((...c)=>n.goAccountManage&&n.goAccountManage(...c)),d:e.o((...c)=>n.goFeedback&&n.goFeedback(...c)),e:e.o((...c)=>n.goAbout&&n.goAbout(...c)),f:e.o((...c)=>n.doDeleteAccount&&n.doDeleteAccount(...c)),g:e.o((...c)=>n.doLogout&&n.doLogout(...c))}}const l=e._export_sfc(u,[["render",g],["__scopeId","data-v-99b0ba47"]]);wx.createPage(l);
